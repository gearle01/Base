<!DOCTYPE html>
<html lang="pt-BR" class="admin-panel">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administração</title>
    <meta name="robots" content="noindex, nofollow">

    <link rel="stylesheet" href="css/critical.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/modal.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <header class="admin-header">
        <h2>Painel de Controle</h2>
        <div class="header-actions">
            <div id="saveStatus" class="save-status saved">
                <span id="saveText">✓ Salvo</span>
            </div>
            <button id="saveButton" class="btn btn-primary" onclick="saveConfig()">Salvar Alterações</button>
            <button class="btn btn-secondary" onclick="logout()">Sair</button>
        </div>
    </header>

    <div class="admin-container">
        <main class="admin-content">
            <div class="content-preview-grid">

                <div class="config-column">
                    <section id="geral" class="config-section">
                        <h3>Geral</h3>
                        <div class="form-group">
                            <label for="empresaNome">Nome da Empresa</label>
                            <input type="text" id="empresaNome" class="form-control"
                                placeholder="Nome que aparece no site" oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label>Tipo de Logo</label>
                            <input type="hidden" id="logoType" value="text">
                            <div class="btn-group">
                                <button class="btn btn-secondary" onclick="setLogoType('text')">Texto</button>
                                <button class="btn btn-secondary" onclick="setLogoType('image')">Imagem</button>
                            </div>
                        </div>
                        <div class="form-group hidden" id="logoImageInputGroup">
                            <label for="logoUpload">Upload do Logo</label>
                            <div class="image-upload-box">
                                <div class="image-preview" id="logoPreview" style="background-image: url('');"></div>
                                <input type="file" id="logoUpload" class="form-control"
                                    accept="image/png, image/jpeg, image/svg+xml, image/webp"
                                    onchange="handleImageUpload(event, 'logoImageUrl', '#logoPreview')">
                            </div>
                            <input type="text" id="logoImageUrl" class="form-control"
                                placeholder="URL do logo (automático)" readonly oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="faviconUpload">Favicon (Ícone da Aba)</label>
                            <div class="image-upload-box small">
                                <div class="image-preview" id="faviconPreview" style="background-image: url('');"></div>
                                <input type="file" id="faviconUpload" class="form-control"
                                    accept="image/png, image/ico, image/svg+xml"
                                    onchange="handleImageUpload(event, 'faviconImageUrl', '#faviconPreview')">
                            </div>
                            <input type="text" id="faviconImageUrl" class="form-control"
                                placeholder="URL do favicon (automático)" readonly oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="bannerTitulo">Título do Banner</label>
                            <input type="text" id="bannerTitulo" class="form-control" placeholder="Título principal"
                                oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="bannerSubtitulo">Subtítulo do Banner</label>
                            <input type="text" id="bannerSubtitulo" class="form-control" placeholder="Texto de apoio"
                                oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="bannerUpload">Imagem de Fundo do Banner</label>
                            <div class="image-upload-box">
                                <div class="image-preview" id="bannerPreview" style="background-image: url('');"></div>
                                <input type="file" id="bannerUpload" class="form-control"
                                    accept="image/png, image/jpeg, image/webp"
                                    onchange="handleImageUpload(event, 'bannerImagem', '#bannerPreview')">
                            </div>
                            <input type="text" id="bannerImagem" class="form-control"
                                placeholder="URL da imagem (automático)" readonly oninput="markAsUnsaved(); update();">
                        </div>
                    </section>

                    <section id="cores" class="config-section">
                        <h3>Cores e Fontes</h3>
                        <div class="form-group">
                            <label for="corPrimaria">Cor Primária</label>
                            <input type="color" id="corPrimaria" class="form-control color-input" value="#007bff"
                                oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="corSecundaria">Cor Secundária</label>
                            <input type="color" id="corSecundaria" class="form-control color-input" value="#28a745"
                                oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="fontUrl">URL da Fonte (Google Fonts)</label>
                            <input type="text" id="fontUrl" class="form-control"
                                placeholder="Ex: https://fonts.googleapis.com/css2?family=Roboto..."
                                oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="fontFamily">Nome da Fonte (CSS)</label>
                            <input type="text" id="fontFamily" class="form-control"
                                placeholder="Ex: 'Roboto', sans-serif" oninput="markAsUnsaved(); update();">
                        </div>
                    </section>

                    <section id="sobre" class="config-section">
                        <h3>Sobre</h3>
                        <div class="form-group">
                            <label for="sobreTexto">Texto</label>
                            <textarea id="sobreTexto" class="form-control" rows="8"
                                oninput="markAsUnsaved(); update();"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="sobreUpload">Imagem da Seção Sobre</label>
                            <div class="image-upload-box">
                                <div class="image-preview" id="sobrePreview" style="background-image: url('');"></div>
                                <input type="file" id="sobreUpload" class="form-control"
                                    accept="image/png, image/jpeg, image/webp"
                                    onchange="handleImageUpload(event, 'sobreImagem', '#sobrePreview')">
                            </div>
                            <input type="text" id="sobreImagem" class="form-control"
                                placeholder="URL da imagem (automático)" readonly oninput="markAsUnsaved(); update();">
                        </div>
                    </section>

                    <section id="produtos" class="config-section">
                        <h3>Produtos/Serviços</h3>
                        <div id="produtosList"></div>
                        <button class="btn btn-secondary" onclick="openProdutoModal(-1)">Adicionar Produto</button>
                    </section>

                    <section id="contato" class="config-section">
                        <h3>Contato e Mapa</h3>
                        <div class="form-group">
                            <label for="telefone">Telefone (WhatsApp)</label>
                            <input type="tel" id="telefone" class="form-control" oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="telefone2">Telefone 2 (Opcional)</label>
                            <input type="tel" id="telefone2" class="form-control" oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="email">E-mail</label>
                            <input type="email" id="email" class="form-control" oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group">
                            <label for="endereco">Endereço</label>
                            <input type="text" id="endereco" class="form-control" oninput="markAsUnsaved(); update();">
                        </div>
                        <div class="form-group form-check">
                            <input type="checkbox" id="mostrarMapa" class="form-check-input"
                                onchange="markAsUnsaved(); update();">
                            <label for="mostrarMapa" class="form-check-label">Mostrar Mapa</label>
                        </div>
                        <div class="form-group">
                            <label>Latitude / Longitude</label>
                            <div class="input-group">
                                <input type="number" id="latitude" class="form-control"
                                    oninput="markAsUnsaved(); update();">
                                <input type="number" id="longitude" class="form-control"
                                    oninput="markAsUnsaved(); update();">
                            </div>
                            <small>Clique no mapa para definir.</small>
                        </div>
                        <div id="adminMap" style="height: 300px; border-radius: 8px; margin-top: 1rem;"></div>
                    </section>

                    <section id="social" class="config-section">
                        <h3>Redes Sociais</h3>
                        <div id="socialLinksList" class="social-links-admin-list"></div>
                        <div id="socialEmptyState" class="empty-state">
                            <p>Nenhuma rede social adicionada.</p>
                        </div>
                        <button class="btn btn-secondary" onclick="addSocialLink()">Adicionar Rede Social</button>
                    </section>

                    <section id="modulos" class="config-section">
                        <h3>Módulos Visíveis</h3>
                        <div class="module-toggle-list">
                            <div class="module-toggle">
                                <span>Sobre</span>
                                <div class="switch" data-module="sobre"></div>
                            </div>
                            <div class="module-toggle">
                                <span>Produtos</span>
                                <div class="switch" data-module="produtos"></div>
                            </div>
                            <div class="module-toggle">
                                <span>Contato</span>
                                <div class="switch" data-module="contato"></div>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="preview-column">
                    <div class="preview-sticky-container">
                        <iframe id="preview-iframe" src="index.html" title="Preview do Site"></iframe>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="produtoModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeProdutoModal()">&times;</span>
            <h4 id="produtoModalTitle">Produto</h4>
            <input type="hidden" id="produtoId">
            <div class="form-group">
                <label>Imagem</label>
                <div class="image-upload-box">
                    <div class="image-preview" id="produtoPreview"
                        style="background-image: url(''); min-height: 150px; background-size: contain; background-repeat: no-repeat; background-position: center; background-color: #f8f9fa;">
                    </div>
                    <input type="file" id="produtoUpload" class="form-control" accept="image/*"
                        onchange="handleImageUpload(event, 'produtoImageUrl', '#produtoPreview')">
                </div>
                <input type="hidden" id="produtoImageUrl">
            </div>
            <div class="form-group"><label>Nome</label><input type="text" id="produtoNome" class="form-control"></div>
            <div class="form-group"><label>Preço</label><input type="text" id="produtoPreco" class="form-control"></div>
            <div class="form-group"><label>Descrição</label><textarea id="produtoDescricao"
                    class="form-control"></textarea></div>
            <button class="btn btn-primary" onclick="saveProduto()">Salvar</button>
        </div>
    </div>

    <div id="socialLinkModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeSocialModal()">&times;</span>
            <h4>Rede Social</h4>
            <input type="hidden" id="currentSocialLinkIndex">
            <div class="form-group"><label>Nome</label><input type="text" id="socialLinkName" class="form-control">
            </div>
            <div class="form-group"><label>URL</label><input type="url" id="socialLinkUrl" class="form-control"></div>
            <button class="btn btn-primary" onclick="saveSocialLinkChanges()">Salvar</button>
        </div>
    </div>

    <div id="toastContainer"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="js/firebase-config.local.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/validation.js"></script>

    <script src="js/leaflet-loader.js" type="module"></script>
    <script src="js/config-manager.js" type="module"></script>
    <script src="js/admin-map.js" type="module"></script>
    <script src="js/smart-cache.js" type="module"></script>

    <script src="js/auth-manager.js"></script>
    <script src="js/firebase-manager.js"></script>
    <script src="js/app.js"></script>

    <script type="module">
        import { adminMap } from './js/admin-map.js';
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (document.getElementById('adminMap') && adminMap) {
                    adminMap.init('adminMap').catch(console.error);
                }
            }, 1500);
        });
    </script>
</body>

</html>